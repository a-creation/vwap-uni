const { MongoClient, ServerApiVersion } = require('mongodb');
require('dotenv').config();

const uri = process.env.MONGO_URI;
const client = new MongoClient(uri, { useNewUrlParser: true, useUnifiedTopology: true, serverApi: ServerApiVersion.v1 });

// This function writes data to MongoDB 

const main = async () => {

  let data_str = `2022-07-24 01:00
  13600370.132942379
  2022-07-24 00:00
  20613932.185104176
  2022-07-23 23:00
  22269549.62586266
  2022-07-23 22:00
  34813572.30133406
  2022-07-23 21:00
  8505217.164138433
  2022-07-23 20:00
  20623483.84576078
  2022-07-23 19:00
  19960825.04858302
  2022-07-23 18:00
  27277444.825340506
  2022-07-23 17:00
  34289782.97219042
  2022-07-23 16:00
  22704722.204997588
  2022-07-23 15:00
  20779616.46280913
  2022-07-23 14:00
  20192575.65143293
  2022-07-23 13:00
  11727252.53507179
  2022-07-23 12:00
  36112791.168169945
  2022-07-23 11:00
  26715009.746325955
  2022-07-23 10:00
  23459072.310330175
  2022-07-23 09:00
  18714611.069667265
  2022-07-23 08:00
  30426441.24992539
  2022-07-23 07:00
  16895393.39271893
  2022-07-23 06:00
  27654378.75491496
  2022-07-23 05:00
  14242801.870661072
  2022-07-23 04:00
  16087229.47070466
  2022-07-23 03:00
  13686298.506282084
  2022-07-23 02:00
  19586636.89956997
  2022-07-23 01:00
  18309823.681083515
  2022-07-23 00:00
  23508867.869661424
  2022-07-22 23:00
  20425632.487647578
  2022-07-22 22:00
  19559600.616050895
  2022-07-22 21:00
  21125710.827181287
  2022-07-22 20:00
  31074016.38321614
  2022-07-22 19:00
  43970696.53016933
  2022-07-22 18:00
  18586590.232523434
  2022-07-22 17:00
  31869216.922691908
  2022-07-22 16:00
  25934756.986463703
  2022-07-22 15:00
  30807494.07276204
  2022-07-22 14:00
  63369981.099611185
  2022-07-22 13:00
  36668251.568910524
  2022-07-22 12:00
  15672061.975745142
  2022-07-22 11:00
  14362572.440849198
  2022-07-22 10:00
  14855154.697673785
  2022-07-22 09:00
  25529424.98306909
  2022-07-22 08:00
  24118158.12545877
  2022-07-22 07:00
  28497706.852980062
  2022-07-22 06:00
  19474889.316605035
  2022-07-22 05:00
  15040264.47923438
  2022-07-22 04:00
  8606173.862274991
  2022-07-22 03:00
  18151949.219303556
  2022-07-22 02:00
  12936802.391881973
  2022-07-22 01:00
  24343114.483914252
  2022-07-22 00:00
  16832418.374136146
  2022-07-21 23:00
  17011836.539470326
  2022-07-21 22:00
  19004222.137386966
  2022-07-21 21:00
  19146955.03521841
  2022-07-21 20:00
  34256927.55696316
  2022-07-21 19:00
  20880781.223267194
  2022-07-21 18:00
  18527957.13102325
  2022-07-21 17:00
  40951216.52323041
  2022-07-21 16:00
  70809141.7900408
  2022-07-21 15:00
  22633558.2780655
  2022-07-21 14:00
  34610128.82232185
  2022-07-21 13:00
  37102687.0688103
  2022-07-21 12:00
  38461009.98005522
  2022-07-21 11:00
  29837036.339888547
  2022-07-21 10:00
  20910351.512048736
  2022-07-21 09:00
  28906319.106840987
  2022-07-21 08:00
  26485521.778991707
  2022-07-21 07:00
  19097071.58575155
  2022-07-21 06:00
  27379560.046493463
  2022-07-21 05:00
  22232056.089561895
  2022-07-21 04:00
  37426520.72698545
  2022-07-21 03:00
  33955039.1481685
  2022-07-21 02:00
  32486357.272634298
  2022-07-21 01:00
  37974387.719391435
  2022-07-21 00:00
  23428426.827871192
  2022-07-20 23:00
  36484392.78410382
  2022-07-20 22:00
  23971675.494412273
  2022-07-20 21:00
  48350765.79588393
  2022-07-20 20:00
  117961569.15016124
  2022-07-20 19:00
  22029707.17419887
  2022-07-20 18:00
  20938608.873115066
  2022-07-20 17:00
  46254048.87289884
  2022-07-20 16:00
  54109053.543588296
  2022-07-20 15:00
  54726902.10736791
  2022-07-20 14:00
  22294529.589768324
  2022-07-20 13:00
  47750064.949216336
  2022-07-20 12:00
  36538775.63569916
  2022-07-20 11:00
  28410840.912990283
  2022-07-20 10:00
  43391769.96893105
  2022-07-20 09:00
  15141946.503359413
  2022-07-20 08:00
  22162557.231276184
  2022-07-20 07:00
  42790324.1809128
  2022-07-20 06:00
  18462089.56819914
  2022-07-20 05:00
  16263222.648194835
  2022-07-20 04:00
  16160157.113598581
  2022-07-20 03:00
  32008926.115088396
  2022-07-20 02:00
  17801655.585307512
  2022-07-20 01:00
  21034432.372506946
  2022-07-20 00:00
  43444275.08801628
  2022-07-19 23:00
  40660995.07840377
  2022-07-19 22:00
  42429175.51156965
  2022-07-19 21:00
  26199157.715915382
  2022-07-19 20:00
  32575925.19001098
  2022-07-19 19:00
  34669551.51918036
  2022-07-19 18:00
  32057719.458509162
  2022-07-19 17:00
  31229370.801896136
  2022-07-19 16:00
  53840111.37946961
  2022-07-19 15:00
  79061923.5904405
  2022-07-19 14:00
  44529976.680772714
  2022-07-19 13:00
  58379065.501822755
  2022-07-19 12:00
  27627385.83542421
  2022-07-19 11:00
  28590246.795484558
  2022-07-19 10:00
  36121003.591724046
  2022-07-19 09:00
  21594243.111034
  2022-07-19 08:00
  33338148.318686247
  2022-07-19 07:00
  54569267.40675994
  2022-07-19 06:00
  43857191.26426404
  2022-07-19 05:00
  38902483.55484904
  2022-07-19 04:00
  34384950.80769121
  2022-07-19 03:00
  33363561.111920923
  2022-07-19 02:00
  43237054.91842491
  2022-07-19 01:00
  52728447.85374358
  2022-07-19 00:00
  77915943.25078928
  2022-07-18 23:00
  63226364.1211375
  2022-07-18 22:00
  30134745.656476464
  2022-07-18 21:00
  20700216.833719507
  2022-07-18 20:00
  35982464.93384436
  2022-07-18 19:00
  54300224.7579485
  2022-07-18 18:00
  34813321.51118502
  2022-07-18 17:00
  44578789.30439992
  2022-07-18 16:00
  45967642.5225592
  2022-07-18 15:00
  27260236.764684074
  2022-07-18 14:00
  25809126.503535423
  2022-07-18 13:00
  36402518.5294693
  2022-07-18 12:00
  34205686.29886548
  2022-07-18 11:00
  33874899.721823014
  2022-07-18 10:00
  30686480.456293825
  2022-07-18 09:00
  22096982.118011385
  2022-07-18 08:00
  45633813.84149471
  2022-07-18 07:00
  32370206.773637295
  2022-07-18 06:00
  54048675.94814543
  2022-07-18 05:00
  41804864.81083969
  2022-07-18 04:00
  23946993.79419618
  2022-07-18 03:00
  31681329.868126303
  2022-07-18 02:00
  41112365.09281612
  2022-07-18 01:00
  32139938.376471516
  2022-07-18 00:00
  24997577.858474724
  2022-07-17 23:00
  41767417.31635691
  2022-07-17 22:00
  26844744.983654767
  2022-07-17 21:00
  25749112.74776933
  2022-07-17 20:00
  15551219.382594619
  2022-07-17 19:00
  21709239.01934391
  2022-07-17 18:00
  33970013.596936
  2022-07-17 17:00
  62173155.57487758
  2022-07-17 16:00
  20618597.863197435
  2022-07-17 15:00
  17737151.245173026
  2022-07-17 14:00
  21552248.427040763
  2022-07-17 13:00
  52546174.03874065
  2022-07-17 12:00
  19476747.333840434
  2022-07-17 11:00
  19227462.139354594
  2022-07-17 10:00
  25023574.89091005
  2022-07-17 09:00
  28160762.239162456
  2022-07-17 08:00
  14279570.517266486
  2022-07-17 07:00
  18497740.31274411
  2022-07-17 06:00
  30410750.621629924
  2022-07-17 05:00
  13368860.829211889
  2022-07-17 04:00
  13984296.74662103
  2022-07-17 03:00
  19585216.793819897
  `

  let data_arr = data_str.replace( /\n/g, " " ).split(/\s+/);
  const documents = [];

  data_arr.map((ele,idx) => {
    if(ele.length === 10){
      document = {};
      let date = ele.split('-')
      document["hour"] = new Date(Date.UTC(date[0], date[1]-1, date[2], data_arr[idx+1].slice(0,2)))
      document["hourly_volume_usdc"] = data_arr[idx+2]
      documents.push(document)
    }
  })

  await client.connect()
  const collection = client.db("uniswap_v3").collection("volume_usdc");

  await collection.remove({})
  await collection.insertMany(documents); 

  client.close();

}

main()



